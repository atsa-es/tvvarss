<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to using time varying vector autoregressive models (TVVARSS) • tvvarss</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to using time varying vector autoregressive models (TVVARSS)">
<meta property="og:description" content="tvvarss">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tvvarss</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro_tvvarss.html">Introduction to using time varying vector autoregressive models (TVVARSS)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nwfsc-timeseries/atsar/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro_tvvarss_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to using time varying vector autoregressive models (TVVARSS)</h1>
                        <h4 class="author">Eric Ward, Mark Scheuerell, Steve Katz</h4>
            
            <h4 class="date">2021-03-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nwfsc-timeseries/atsar/blob/master/vignettes/intro_tvvarss.Rmd"><code>vignettes/intro_tvvarss.Rmd</code></a></small>
      <div class="hidden name"><code>intro_tvvarss.Rmd</code></div>

    </div>

    
    
<div id="requirements" class="section level1">
<h1 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h1>
<p>All analyses require the <a href="https://cran.r-project.org/">R software</a> (v3.4) for data simulation, processing, and summarizing model results; and the <a href="http://mc-stan.org/">Stan software</a> for Hamiltonian Monte Carlo (HMC) simulation.</p>
<p>We begin by installing the <code>tvvarss</code> package (if necessary) and then loading it.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#if (require(devtools)) {</span>
<span class="co">#    devtools::install_github("nwfsc-timeseries/tvvarss")</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/nwfsc-timeseries/tvvarss">"tvvarss"</a></span><span class="op">)</span>
<span class="co">#}</span></code></pre></div>
</div>
<div id="simulating-data" class="section level1">
<h1 class="hasAnchor">
<a href="#simulating-data" class="anchor"></a>Simulating data</h1>
<p>The <code>tvvarss</code> package includes the the function <code><a href="../reference/simTVVAR.html">simTVVAR()</a></code> to simulate the process component of a TVVARSS model (<em>i.e.</em>, it does not add observation error). The primary input to <code><a href="../reference/simTVVAR.html">simTVVAR()</a></code> is the [<em>n</em> x <em>n</em>] matrix (or [<em>n</em> x <em>n</em> x 1] array) <code>Bt</code>, which specifies the intra- and inter-species interactions. If <code>Bt</code> is a matrix, then it is used to specify the initial conditions for <span class="math inline">\(\mathbf{B}_t\)</span>.</p>
<p>the food web topology. Specifically, interactions are expressed as the effect of column on row; the diagonals indicate the strength of density-dependence. All elements of the matrix corresponding to no interaction are set to 0.</p>
<p><code>tvvarss</code> is designed to work with symbolic representations within <code>B0</code>, based on the following <code>character</code> codes:</p>
<ul>
<li>
<code>"dd"</code> for density-dependence (this is implied in TVVARSS models)</li>
<li>
<code>"td"</code> for top-down</li>
<li>
<code>"bu"</code> for bottom-up</li>
<li>
<code>"cf"</code> for competitive/facilitative</li>
</ul>
<p>We show four different examples of simulated food web topologies.</p>
<div id="ex-1-linear-food-chain" class="section level2">
<h2 class="hasAnchor">
<a href="#ex-1-linear-food-chain" class="anchor"></a>Ex 1: Linear food chain</h2>
<p>For the first example, we model 4 tropic levels stacked in a linear food chain from primary producers <code>PP</code> at the bottom to tertiary consumers <code>TC</code> at the top.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TC"</span>,<span class="st">"SC"</span>,<span class="st">"PC"</span>,<span class="st">"PP"</span><span class="op">)</span>
<span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">nn</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,<span class="st">"\n|\n"</span>,collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,<span class="va">lvls</span><span class="op">[</span><span class="va">nn</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## TC
## |
## SC
## |
## PC
## |
## PP</code></pre>
<p>Here is the topology in a matrix form that <code><a href="../reference/simTVVAR.html">simTVVAR()</a></code> will understand.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## initial conditions for B_t</span>
<span class="va">B0_ex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,<span class="va">nn</span>,<span class="va">nn</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">B0_ex1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">lvls</span>,<span class="va">lvls</span><span class="op">)</span>
<span class="co">## diagonal elements = density-dependence</span>
<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">B0_ex1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"dd"</span>,<span class="fl">4</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">nn</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">B0_ex1</span><span class="op">[</span><span class="va">i</span>,<span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"bu"</span>
  <span class="va">B0_ex1</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"td"</span>
<span class="op">}</span>
<span class="co">## inspect B0</span>
<span class="va">B0_ex1</span></code></pre></div>
<pre><code>##    TC   SC   PC   PP  
## TC "dd" "bu" 0    0   
## SC "td" "dd" "bu" 0   
## PC 0    "td" "dd" "bu"
## PP 0    0    "td" "dd"</code></pre>
<p>We can now simulate a TVVAR process based on this expression of the food web topology. In addition to the matrix specifying the topology, the simulator needs to know the length of time series and some information about the variances of the process errors for <span class="math inline">\(\mathbf{B}_t\)</span> and the states <span class="math inline">\(\mathbf{x}_t\)</span>. For this example, we will assume IID errors.</p>
<p>Here is a 30-unit, simulated TVVAR process.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TT</span> <span class="op">&lt;-</span> <span class="fl">35</span>
<span class="co">## simulate</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">666</span><span class="op">)</span>
<span class="va">ex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simTVVAR.html">simTVVAR</a></span><span class="op">(</span>Bt <span class="op">=</span> <span class="cn">NULL</span>, topo <span class="op">=</span> <span class="va">B0_ex1</span>, TT <span class="op">=</span> <span class="va">TT</span>,
                var_QX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">/</span><span class="fl">20</span>, cov_QX <span class="op">=</span> <span class="fl">0</span>,
                var_QB <span class="op">=</span> <span class="fl">0.10</span>, cov_QB <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">## plot states</span>
<span class="va">clr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"purple"</span>,<span class="st">"darkred"</span>,<span class="st">"blue"</span>,<span class="st">"darkgreen"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, omi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">ex1</span><span class="op">$</span><span class="va">states</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"solid"</span>, lwd<span class="op">=</span><span class="fl">2</span>, xpd<span class="op">=</span><span class="cn">NA</span>,
        col<span class="op">=</span><span class="va">clr</span>, ylab<span class="op">=</span><span class="st">"Log density"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"right"</span>, legend<span class="op">=</span><span class="va">lvls</span>, lty<span class="op">=</span><span class="st">"solid"</span>, lwd<span class="op">=</span><span class="fl">2</span>, bty<span class="op">=</span><span class="st">"n"</span>,
       col<span class="op">=</span><span class="va">clr</span>, inset<span class="op">=</span><span class="op">-</span><span class="fl">0.2</span>, xpd<span class="op">=</span><span class="cn">NA</span>, cex<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></code></pre></div>
<p><img src="intro_tvvarss_files/figure-html/ex_1_sim-1.png" width="672"></p>
<p>Now we simulate many TVVAR processes of this form and inspect them.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## number of simulations</span>
<span class="va">ee</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="co">## list for results</span>
<span class="va">ex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>,<span class="va">ee</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">ee</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">ex1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simTVVAR.html">simTVVAR</a></span><span class="op">(</span>Bt <span class="op">=</span> <span class="cn">NULL</span>, topo <span class="op">=</span> <span class="va">B0_ex1</span>, TT <span class="op">=</span> <span class="va">TT</span>,
                       var_QX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">/</span><span class="fl">20</span>, cov_QX <span class="op">=</span> <span class="fl">0</span>,
                       var_QB <span class="op">=</span> <span class="fl">0.10</span>, cov_QB <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">0.9</span>,<span class="fl">0.3</span>,<span class="fl">0</span><span class="op">)</span>, omi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">ex1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">states</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"solid"</span>, lwd<span class="op">=</span><span class="fl">2</span>, xpd<span class="op">=</span><span class="cn">NA</span>,
          col<span class="op">=</span><span class="va">clr</span>, main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Simulation "</span>,<span class="va">i</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">"Log density"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"right"</span>, legend<span class="op">=</span><span class="va">lvls</span>, lty<span class="op">=</span><span class="st">"solid"</span>, lwd<span class="op">=</span><span class="fl">2</span>, bty<span class="op">=</span><span class="st">"n"</span>,
         col<span class="op">=</span><span class="va">clr</span>, inset<span class="op">=</span><span class="op">-</span><span class="fl">0.2</span>, xpd<span class="op">=</span><span class="cn">NA</span>, cex<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="intro_tvvarss_files/figure-html/ex_1_lots-1.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_lots-2.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_lots-3.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_lots-4.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_lots-5.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_lots-6.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_lots-7.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_lots-8.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_lots-9.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_lots-10.png" width="672"></p>
<p>Clearly some of the simulated processes must have diagonal values in <strong>B</strong> are close to 1, which combine with some of the off-diagonal elements to create unrealistic, boom-bust population dynamics. Let’s develop a screening process to toss those out.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## min log-density threshold</span>
<span class="va">dens_min</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">5</span>
<span class="co">## max log-density threshold</span>
<span class="va">dens_max</span> <span class="op">&lt;-</span> <span class="fl">7</span>
<span class="va">ex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>,<span class="va">ee</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">ee</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>states<span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">dens_max</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">while</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">states</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dens_max</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">states</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">dens_min</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simTVVAR.html">simTVVAR</a></span><span class="op">(</span>Bt <span class="op">=</span> <span class="cn">NULL</span>, topo <span class="op">=</span> <span class="va">B0_ex1</span>, TT <span class="op">=</span> <span class="va">TT</span>,
                    var_QX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">/</span><span class="fl">20</span>, cov_QX <span class="op">=</span> <span class="fl">0</span>,
                    var_QB <span class="op">=</span> <span class="fl">0.10</span>, cov_QB <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">ex1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tmp</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">0.9</span>,<span class="fl">0.3</span>,<span class="fl">0</span><span class="op">)</span>, omi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">ex1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">states</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"solid"</span>, lwd<span class="op">=</span><span class="fl">2</span>, xpd<span class="op">=</span><span class="cn">NA</span>,
          col<span class="op">=</span><span class="va">clr</span>, main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Simulation "</span>,<span class="va">i</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">"Log density"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"right"</span>, legend<span class="op">=</span><span class="va">lvls</span>, lty<span class="op">=</span><span class="st">"solid"</span>, lwd<span class="op">=</span><span class="fl">2</span>, bty<span class="op">=</span><span class="st">"n"</span>,
         col<span class="op">=</span><span class="va">clr</span>, inset<span class="op">=</span><span class="op">-</span><span class="fl">0.2</span>, xpd<span class="op">=</span><span class="cn">NA</span>, cex<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="intro_tvvarss_files/figure-html/ex_1_screening-1.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_screening-2.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_screening-3.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_screening-4.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_screening-5.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_screening-6.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_screening-7.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_screening-8.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_screening-9.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_1_screening-10.png" width="672"></p>
</div>
<div id="ex-2-grazers-plants" class="section level2">
<h2 class="hasAnchor">
<a href="#ex-2-grazers-plants" class="anchor"></a>Ex 2: Grazers &amp; plants</h2>
<p>For the second example, we model 2 tropic levels with 2 different primary producers and 2 different consumers.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C1"</span>,<span class="st">"C2"</span>,<span class="st">"P1"</span>,<span class="st">"P2"</span><span class="op">)</span>
<span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C1-C2\n| X |\nP1-P2"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## C1-C2
## | X |
## P1-P2</code></pre>
<p>Here is the topology in a matrix form that <code><a href="../reference/simTVVAR.html">simTVVAR()</a></code> will understand.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## initial conditions for B_t</span>
<span class="va">B0_ex2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,<span class="va">nn</span>,<span class="va">nn</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">B0_ex2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">lvls</span>,<span class="va">lvls</span><span class="op">)</span>
<span class="co">## diagonal elements = density-dependence</span>
<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">B0_ex2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"dd"</span>,<span class="fl">4</span><span class="op">)</span>
<span class="va">B0_ex2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"bu"</span>
<span class="va">B0_ex2</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"td"</span>
<span class="va">B0_ex2</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">B0_ex2</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">B0_ex2</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">B0_ex2</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"cf"</span>
<span class="co">## inspect B0</span>
<span class="va">B0_ex2</span></code></pre></div>
<pre><code>##    C1   C2   P1   P2  
## C1 "dd" "cf" "bu" "bu"
## C2 "cf" "dd" "bu" "bu"
## P1 "td" "td" "dd" "cf"
## P2 "td" "td" "cf" "dd"</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ee</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="co">## min log-density threshold</span>
<span class="va">dens_min</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">5</span>
<span class="co">## max log-density threshold</span>
<span class="va">dens_max</span> <span class="op">&lt;-</span> <span class="fl">7</span>
<span class="va">ex2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"list"</span>,<span class="va">ee</span><span class="op">)</span>
<span class="va">clr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkblue"</span>,<span class="st">"steelblue"</span>,<span class="st">"darkgreen"</span>,<span class="st">"darkolivegreen4"</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">ee</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>states<span class="op">=</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">dens_max</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">while</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">states</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">dens_max</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">states</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">dens_min</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simTVVAR.html">simTVVAR</a></span><span class="op">(</span>Bt <span class="op">=</span> <span class="cn">NULL</span>, topo <span class="op">=</span> <span class="va">B0_ex2</span>, TT <span class="op">=</span> <span class="va">TT</span>,
                    var_QX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">/</span><span class="fl">20</span>, cov_QX <span class="op">=</span> <span class="fl">0</span>,
                    var_QB <span class="op">=</span> <span class="fl">0.10</span>, cov_QB <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">ex2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tmp</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">0.9</span>,<span class="fl">0.3</span>,<span class="fl">0</span><span class="op">)</span>, omi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">ex2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">states</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, lty<span class="op">=</span><span class="st">"solid"</span>, lwd<span class="op">=</span><span class="fl">2</span>, xpd<span class="op">=</span><span class="cn">NA</span>,
          col<span class="op">=</span><span class="va">clr</span>, main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Simulation "</span>,<span class="va">i</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">"Log density"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"right"</span>, legend<span class="op">=</span><span class="va">lvls</span>, lty<span class="op">=</span><span class="st">"solid"</span>, lwd<span class="op">=</span><span class="fl">2</span>, bty<span class="op">=</span><span class="st">"n"</span>,
         col<span class="op">=</span><span class="va">clr</span>, inset<span class="op">=</span><span class="op">-</span><span class="fl">0.2</span>, xpd<span class="op">=</span><span class="cn">NA</span>, cex<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="intro_tvvarss_files/figure-html/ex_2_screening-1.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_2_screening-2.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_2_screening-3.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_2_screening-4.png" width="672"><img src="intro_tvvarss_files/figure-html/ex_2_screening-5.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Eric Ward, Mark Scheuerell, Steve Katz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
